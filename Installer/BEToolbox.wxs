<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi" xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">

   <!-- Include project wide variables -->
   <?include Variables.wxi?>

   <Fragment>
      
      <!-- Start menu item for help file -->
      <DirectoryRef Id="BridgeLinkStartMenuFolder">
         <Component Id="BEToolboxShortcuts" Guid="{6777548A-04BF-4d86-A184-51DEEB27D552}" Win64="$(var.IsWin64)">

           <util:InternetShortcut Id="BEToolboxDocShortcut" Name="BEToobox Documentation" Target="http://www.wsdot.wa.gov/eesc/bridge/software/Documentation/BEToolbox/3.0"/>

           <RegistryValue Root="HKCU"
                           Key="Software\Microsoft\[ProductName]"
                           Name="installed"
                           Type="integer"
                           Value="1"
                           KeyPath="yes"/>

         </Component>
      </DirectoryRef>

      <!-- BEToolbox files -->
      <DirectoryRef Id="APPLICATIONFOLDER"
                    FileSource ="$(var.BEToolboxSourceRoot)\$(var.PlatformFolder)" >
         <Component Id ="BEToolboxComponents"
                    Guid="{AD5706B4-F2CE-4153-A263-C549D0E28B2F}"
                    Win64="$(var.IsWin64)">

            <File Id="BEToolbox.dll"    Name="BEToolbox.dll" KeyPath ="yes"/>

            <!-- BEToolbox file associations -->
            <ProgId Id="UltCol.Document" Icon="BEToolbox.dll" IconIndex="4" />
            <ProgId Id="GenComp.Document" Icon="BEToolbox.dll" IconIndex="1" />
            <ProgId Id="GirComp.Document" Icon="BEToolbox.dll" IconIndex="3"/>
            <ProgId Id="BoxGdr.Document" Icon="BEToolbox.dll" IconIndex="2"/>
            <ProgId Id="Curvel.Document" Icon="BEToolbox.dll" IconIndex="6"/>

            <!-- BEToolbox registry entries-->
            
            <!-- BEToolbox Application Plugin -->
            <?define BEToolboxCLSID={B5E128D4-78F3-48e0-970E-812C2281EE4E}?>
            <RegistryKey ForceCreateOnInstall="yes"
                         ForceDeleteOnUninstall="yes"
                         Root="HKCR"
                         Key ="CLSID\$(var.BEToolboxCLSID)"/>
            <RegistryValue Root="HKCR"
                           Key="CLSID\$(var.BEToolboxCLSID)"
                           Value="BEToolbox"
                           Type="string" />
            <RegistryValue Root="HKCR"
                           Key="CLSID\$(var.BEToolboxCLSID)\InprocServer32"
                           Value="[APPLICATIONFOLDER]BEToolbox.dll"
                           Type="string" />
            <RegistryValue Root="HKCR"
                           Key="CLSID\$(var.BEToolboxCLSID)\Implemented Categories\$(var.BridgeLinkAppPluginCATID)"
                           Value=""
                           Type="string" />
            
            <!-- BEToolbox Component Information Object -->
            <?define BEToolboxComponentInfoCLSID={8BC4CCD2-35D5-4f2c-AA18-0E2D58FF5C3A}?>
            <RegistryKey ForceCreateOnInstall="yes"
                         ForceDeleteOnUninstall="yes"
                         Root="HKCR"
                         Key ="CLSID\$(var.BEToolboxComponentInfoCLSID)"/>
            <RegistryValue Root="HKCR"
                           Key="CLSID\$(var.BEToolboxComponentInfoCLSID)"
                           Value="BEToolbox Component Information"
                           Type="string" />
            <RegistryValue Root="HKCR"
                           Key="CLSID\$(var.BEToolboxComponentInfoCLSID)\InprocServer32"
                           Value="[APPLICATIONFOLDER]BEToolbox.dll"
                           Type="string" />
            <RegistryValue Root="HKCR"
                           Key="CLSID\$(var.BEToolboxComponentInfoCLSID)\Implemented Categories\$(var.BridgeLinkComponentInfoCATID)"
                           Value=""
                           Type="string" />

         </Component>
      </DirectoryRef >

      <DirectoryRef Id="APPLICATIONFOLDER"
                    FileSource ="$(var.BEToolboxSourceRoot)\Images" >
         <Component Id="BEToolboxImageFiles" Guid="{6FF7750C-7DEC-42ea-9CF1-953BEB46B9D1}" Win64="$(var.IsWin64)">
            <File Id="BoxGdr.png"    Name="BoxGdr.png" KeyPath="yes"/>
            <File Id="Curvel.png"    Name="Curvel.png"/>
            <File Id="GirComp.png"   Name="GirComp.png"/>
         </Component>
      </DirectoryRef >

     <!-- BEToolboxXML -->
     <DirectoryRef Id="APPLICATIONFOLDER"
                   FileSource ="$(var.BEToolboxSourceRoot)\$(var.PlatformFolder)" >
       <Component Id="BEToolboxXML" Guid="{1415A11D-9B93-4aa3-AC21-39B61DCDDFBD}" Win64="$(var.IsWin64)">
         <File Id="BEToolboxXML.dll"    Name="BEToolboxXML.dll" KeyPath="yes"/>
       </Component>
     </DirectoryRef >



     <!-- BEToolbox Application Plugin -->
      <Feature Id="BEToolbox"
               Absent="allow"
               ConfigurableDirectory="APPLICATIONFOLDER"
               Description="WSDOT Legacy Bridge Engineering Tools"
               Display="expand"
               Title="BEToolbox (Optional)"
               Level="$(var.BEToolboxFeatureLevel)">
         <ComponentRef Id="BEToolboxComponents" Primary="yes" />
         <ComponentRef Id="BEToolboxShortcuts"/>
         <ComponentRef Id="BEToolboxImageFiles"/>
         <ComponentRef Id="BEToolboxDocs"/>
        <ComponentRef Id="BEToolboxXML"/>
      </Feature>
   </Fragment>
</Wix>

